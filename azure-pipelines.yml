trigger:
  branches:
    include:
      - main
      - dev

pool:
  vmImage: 'ubuntu-latest'

variables:
  pythonVersion: '3.11'
  dockerRegistryServiceConnection: ''
  imageRepository: 'worknexus'
  containerRegistry: ''
  tag: '$(Build.BuildId)'

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(pythonVersion)'
      addToPath: true

  - script: |
      python -m pip install --upgrade pip
      pip install -r requirements.txt || echo "No requirements.txt yet"
    displayName: 'Install dependencies'

  - script: |
      echo "Running lint and unit tests..."
      python -m unittest discover tests || echo "No tests yet"
    displayName: 'Run tests'

  - task: Docker@2
    displayName: Build Docker image
    inputs:
      command: build
      Dockerfile: '**/Dockerfile'
      tags: |
        $(tag)

  - script: |
      echo "âœ… CI build completed successfully for WorkNexus!"
    displayName: 'Build completion'
