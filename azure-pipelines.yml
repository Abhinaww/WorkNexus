trigger:
  branches:
    include:
      - main
      - dev

pool:
  vmImage: 'ubuntu-latest'

variables:
  pythonVersion: '3.11'
  imageRepository: 'worknexus'
  tag: '$(Build.BuildId)'

steps:
  - checkout: self
    persistCredentials: true

  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(pythonVersion)'
      addToPath: true

  - script: |
      python -m pip install --upgrade pip
      if [ -f requirements.txt ]; then pip install -r requirements.txt; else echo "No requirements.txt"; fi
    displayName: 'Install dependencies'

  - script: |
      echo "Running tests (if any)..."
      if [ -d tests ]; then python -m unittest discover tests || true; else echo "No tests directory"; fi
    displayName: 'Run tests'

  - task: Docker@2
    displayName: Build Docker image
    inputs:
      containerRegistry: ''
      repository: '$(imageRepository)'
      command: build
      Dockerfile: 'Dockerfile'
      tags: |
        $(tag)

  - script: echo "âœ… CI pipeline finished."
    displayName: 'Finish'
